import{a as H,b as W,e as $,f as x,h as G,i as L,j as J}from"./chunk-T6KFCUAR.js";import{C as q,D as K,F as X,I as Y,O as Z}from"./chunk-TULLC7Y6.js";import{g as N,j as V,k as B,l as R,m as z,n as Q}from"./chunk-7AQS2LSG.js";import{$a as h,Ab as T,Db as l,Eb as U,Fb as C,Hb as I,Ib as D,Jb as j,La as r,Lb as A,Mb as v,Nb as M,Ob as b,a as y,b as _,db as c,e as w,ga as p,hb as a,ib as m,ja as O,mb as S,rb as k,sa as u,sb as E,t as g,ta as f,yb as F,zb as P}from"./chunk-PVR3HKZP.js";var te=["messagesContainer"],ie=(n,e)=>({"text-end":n,"text-start":e}),ne=(n,e)=>({"badge bg-primary":n,"badge bg-secondary":e});function se(n,e){n&1&&(a(0,"div",14),l(1," A\xFAn no hay mensajes. \xA1S\xE9 el primero en enviar un mensaje! "),m())}function oe(n,e){if(n&1&&(a(0,"div",15)(1,"div",16)(2,"span",17),l(3),m()(),a(4,"div"),l(5),a(6,"div",18),l(7),m()()()),n&2){let t=e.$implicit,i=E();c("ngClass",v(5,ie,t.isUserMessage,!t.isUserMessage)),r(2),c("ngClass",v(8,ne,t.isUserMessage,!t.isUserMessage)),r(),C(" ",t.user," "),r(2),C(" ",t.text," "),r(2),U(i.formatTimestamp(t.timestamp))}}var ee=class n{firestore=p(W);authService=p(q);messages$=g([]);newMessage="";user="";messagesContainer;constructor(){this.authService.getUser().subscribe(e=>{this.user=e?e.email||"User":"Guest",this.loadMessages()})}ngOnInit(){this.loadMessages()}loadMessages(){let e=x(this.firestore,"messages"),t=J(e,L("timestamp"));G(t,i=>{let s=i.docs.map(d=>{let o=d.data();return _(y({},o),{timestamp:o.timestamp instanceof H?o.timestamp.toDate():o.timestamp,isUserMessage:o.user===this.user})});this.messages$=g(s),setTimeout(()=>this.scrollToBottom(),0)})}sendMessage(){return w(this,null,function*(){if(this.newMessage.trim()){let e=x(this.firestore,"messages");yield $(e,{text:this.newMessage,user:this.user,timestamp:new Date,isUserMessage:!0}),this.newMessage=""}})}formatTimestamp(e){return N(e,"dd/MM/yyyy HH:mm","es-ES")}scrollToBottom(){this.messagesContainer&&(this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=O({type:n,selectors:[["app-chat"]],viewQuery:function(t,i){if(t&1&&F(te,5),t&2){let s;P(s=T())&&(i.messagesContainer=s.first)}},standalone:!0,features:[A],decls:18,vars:7,consts:[["messagesContainer",""],[1,"background-image"],[1,"container"],[1,"card"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body","d-flex","flex-column"],[1,"messages","flex-grow-1","overflow-auto"],["class","text-center text-muted",4,"ngIf"],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card-footer"],[1,"input-group"],["placeholder","Escribe tu mensaje...",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","ms-2",3,"click"],[1,"text-center","text-muted"],[1,"mb-2",3,"ngClass"],[1,"d-inline-block","me-2"],[3,"ngClass"],[1,"text-muted","small"]],template:function(t,i){if(t&1){let s=S();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h4",5),l(5,"Sala de Chat"),m()(),a(6,"div",6)(7,"div",7,0),h(9,se,2,0,"div",8),M(10,"async"),h(11,oe,8,11,"div",9),M(12,"async"),m()(),a(13,"div",10)(14,"div",11)(15,"input",12),j("ngModelChange",function(o){return u(s),D(i.newMessage,o)||(i.newMessage=o),f(o)}),m(),a(16,"button",13),k("click",function(){return u(s),f(i.sendMessage())}),l(17,"Enviar"),m()()()()()()}if(t&2){let s;r(9),c("ngIf",((s=b(10,3,i.messages$))==null?null:s.length)===0),r(2),c("ngForOf",b(12,5,i.messages$)),r(4),I("ngModel",i.newMessage)}},dependencies:[Q,V,B,R,z,Z,K,X,Y],styles:['@charset "UTF-8";.background-image[_ngcontent-%COMP%]{position:relative;z-index:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}.background-image[_ngcontent-%COMP%]:before{content:"";position:absolute;width:100%;height:100%;background-image:url(https://img.freepik.com/fotos-premium/sala-juegos-esta-llena-coloridos-juegos-arcade_662214-35580.jpg?w=740);background-size:cover;background-position:center;z-index:-1}.container[_ngcontent-%COMP%]{position:relative;max-width:100%;width:100%;max-width:600px;margin-top:1rem;background-color:#fff;border-radius:.5rem;box-shadow:0 0 10px #0000001a}.card-body[_ngcontent-%COMP%]{height:400px;display:flex;flex-direction:column}.messages[_ngcontent-%COMP%]{padding:.5rem;background-color:#f8f9fa;display:flex;flex-direction:column;gap:.5rem;overflow-y:auto}.message[_ngcontent-%COMP%]{max-width:100%;word-wrap:break-word;padding:.5rem;border-radius:.5rem}.user-message[_ngcontent-%COMP%]{align-self:flex-end;background-color:#007bff;color:#fff}.received-message[_ngcontent-%COMP%]{align-self:flex-start;background-color:#e9ecef}.text-muted[_ngcontent-%COMP%]{font-size:.75rem}.card-footer[_ngcontent-%COMP%]{padding:1rem}.input-group[_ngcontent-%COMP%]{margin-top:1rem}']})};export{ee as ChatComponent};
