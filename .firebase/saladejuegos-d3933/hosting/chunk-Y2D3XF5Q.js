import{a as q,b as H,e as W,f as _,h as $,i as G,j as L}from"./chunk-HU4CQQFN.js";import{C as J,E as K,H as X,N as Y,P as Z}from"./chunk-OONLYXED.js";import{g as N,j as V,k as B,l as R,m as z,n as Q}from"./chunk-7AQS2LSG.js";import{$a as h,Ab as T,Db as l,Eb as U,Fb as C,Hb as I,Ib as D,Jb as j,La as r,Lb as A,Mb as v,Nb as b,Ob as M,a as x,b as y,db as c,e as w,ga as p,hb as a,ib as m,ja as O,mb as S,rb as k,sa as u,sb as E,t as d,ta as f,yb as F,zb as P}from"./chunk-PVR3HKZP.js";var te=["messagesContainer"],ne=(i,t)=>({"text-end":i,"text-start":t}),ie=(i,t)=>({"badge bg-primary":i,"badge bg-secondary":t});function se(i,t){i&1&&(a(0,"div",14),l(1," A\xFAn no hay mensajes. \xA1S\xE9 el primero en enviar un mensaje! "),m())}function oe(i,t){if(i&1&&(a(0,"div",15)(1,"div",16)(2,"span",17),l(3),m()(),a(4,"div"),l(5),a(6,"div",18),l(7),m()()()),i&2){let e=t.$implicit,n=E();c("ngClass",v(5,ne,e.isUserMessage,!e.isUserMessage)),r(2),c("ngClass",v(8,ie,e.isUserMessage,!e.isUserMessage)),r(),C(" ",e.user," "),r(2),C(" ",e.text," "),r(2),U(n.formatTimestamp(e.timestamp))}}var ee=class i{firestore=p(H);authService=p(Z);messages$=d([]);newMessage="";user="";messagesContainer;constructor(){this.authService.getUser().subscribe(n=>{n?this.user=n.email||"User":this.user="Guest"});let t=_(this.firestore,"messages"),e=L(t,G("timestamp"));$(e,n=>{let s=n.docs.map(g=>{let o=g.data();return y(x({},o),{timestamp:o.timestamp instanceof q?o.timestamp.toDate():o.timestamp,isUserMessage:o.user===this.user})});this.messages$=d(s),this.scrollToBottom()})}ngOnInit(){}sendMessage(){return w(this,null,function*(){if(this.newMessage.trim()){let t=_(this.firestore,"messages");yield W(t,{text:this.newMessage,user:this.user,timestamp:new Date,isUserMessage:!0}),this.newMessage=""}})}formatTimestamp(t){return N(t,"dd/MM/yyyy HH:mm","es-ES")}scrollToBottom(){setTimeout(()=>{this.messagesContainer&&(this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight)},0)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-chat"]],viewQuery:function(e,n){if(e&1&&F(te,5),e&2){let s;P(s=T())&&(n.messagesContainer=s.first)}},standalone:!0,features:[A],decls:18,vars:7,consts:[["messagesContainer",""],[1,"background-image"],[1,"container"],[1,"card"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body","d-flex","flex-column"],[1,"messages","flex-grow-1","overflow-auto"],["class","text-center text-muted",4,"ngIf"],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card-footer"],[1,"input-group"],["placeholder","Escribe tu mensaje...",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","ms-2",3,"click"],[1,"text-center","text-muted"],[1,"mb-2",3,"ngClass"],[1,"d-inline-block","me-2"],[3,"ngClass"],[1,"text-muted","small"]],template:function(e,n){if(e&1){let s=S();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h4",5),l(5,"Sala de Chat"),m()(),a(6,"div",6)(7,"div",7,0),h(9,se,2,0,"div",8),b(10,"async"),h(11,oe,8,11,"div",9),b(12,"async"),m()(),a(13,"div",10)(14,"div",11)(15,"input",12),j("ngModelChange",function(o){return u(s),D(n.newMessage,o)||(n.newMessage=o),f(o)}),m(),a(16,"button",13),k("click",function(){return u(s),f(n.sendMessage())}),l(17,"Enviar"),m()()()()()()}if(e&2){let s;r(9),c("ngIf",((s=M(10,3,n.messages$))==null?null:s.length)===0),r(2),c("ngForOf",M(12,5,n.messages$)),r(4),I("ngModel",n.newMessage)}},dependencies:[Q,V,B,R,z,Y,J,K,X],styles:['@charset "UTF-8";.background-image[_ngcontent-%COMP%]{position:relative;z-index:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}.background-image[_ngcontent-%COMP%]:before{content:"";position:absolute;width:100%;height:100%;background-image:url(https://img.freepik.com/fotos-premium/sala-juegos-esta-llena-coloridos-juegos-arcade_662214-35580.jpg?w=740);background-size:cover;background-position:center;z-index:-1}.container[_ngcontent-%COMP%]{position:relative;max-width:100%;width:100%;max-width:600px;margin-top:1rem;background-color:#fff;border-radius:.5rem;box-shadow:0 0 10px #0000001a}.card-body[_ngcontent-%COMP%]{height:400px}.messages[_ngcontent-%COMP%]{padding:.5rem;background-color:#f8f9fa;display:flex;flex-direction:column;gap:1rem}.message[_ngcontent-%COMP%]{max-width:80%;word-wrap:break-word;padding:.5rem;border-radius:.5rem}.user-message[_ngcontent-%COMP%]{align-self:flex-end;background-color:#007bff;color:#fff}.received-message[_ngcontent-%COMP%]{align-self:flex-start;background-color:#e9ecef}.message-text[_ngcontent-%COMP%]{margin-bottom:.25rem}.text-muted[_ngcontent-%COMP%]{font-size:.75rem}.card-footer[_ngcontent-%COMP%]{padding:1rem}.input-group[_ngcontent-%COMP%]{margin-top:1rem}']})};export{ee as ChatComponent};
